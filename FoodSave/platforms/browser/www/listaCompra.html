<head>
    <meta charset="utf-8">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi">

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/listaCompra.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap-theme.min.css">
    <link href="css/animate.css" rel="stylesheet" type="text/css">
    <link href="css/fileinput.css" rel="stylesheet">
    <title>Food Save the World</title>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/fileinput.min.js"></script>
    <script src="js/select2.js"></script>
    <link rel="stylesheet" type="text/css" href="css/select2.css">
</head>

<body>
    <!-- Cargando Datos -->
    <div class="loading">
        <div id="fondo"></div>
        <div id="logoCentro">
            <img src="img/logoTitCS.png">
            <div id="progress">
                <div class="progress-bar progress-bar-primary progress-bar-striped active" role="progressbar" style="width:100%">L O A D I N G</div>
            </div>
        </div>
    </div>

    <!-- Empieza la página -->

    <div class="container" style="margin-top: 2px;">
        <nav class="navbar navbar-fixed-top" role="navigation">
            <!-- El logotipo y el icono que despliega el menú se agrupan
       para mostrarlos mejor en los dispositivos móviles -->
            <div class="navbar-header">
                <div class="table-responsive">
                    <table class="table">
                        <tbody>
                            <tr>
                                <td class="pull-left">
                                    <a href="javascript:void(0);" class="btn btn-naranja btn-lg pull-left" onclick="regresaAnt()"><span class="glyphicon glyphicon-chevron-left"></span>
                                    </a>
                                </td>
                                <td>
                                    <a href="index.html"><img src="img/CS_fondoAzul.png" width="150px">
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Agrupar los enlaces de navegación, los formularios y cualquier
       otro elemento que se pueda ocultar al minimizar la barra -->
        </nav>

        <div class="panel">
            <div class="panel-heading">
                <h5><b>SHOPPING LIST</b></h5>

                <div class="panel-body">
                    <!-- Formulario -->
                    <form id="frmListaCompra" class="form-horizontal" role="form">
                        <div class="form-group">
                            <label for="txtFechaCompra" class="control-label col-xs-3">DATE</label>
                            <div class="col-xs-9">
                                <input type="date" class="form-control" id="txtFechaCompra" name="fecha">
                            </div>
                        </div>
                        <div class="form-group">
                            <textarea class="form-control" placeholder="Escribe la lista de productos" rows="5" name="descripcion_compra" id="txtDescr_compra"></textarea>
                        </div>
                        <div class="btn-group btn-group-sm btn-group-justified">
                            <a role="button" class="btn btn-success" href="javascript:{}" onclick="$('#frmListaCompra').submit()">ADD</a>
                            <a role="button" class="btn btn-danger" href="index.html">CANCEL</a>
                        </div>

                    </form>

                </div>
            </div>

        </div>
        <script type="text/javascript">
            $(document).ready(function() {

                $(document).ajaxStart(function() {
                    $('.loading').css('display', 'flex');
                });

                $(document).ajaxComplete(function() {
                    $('.loading').css('display', 'none');
                });
                /*  document.addEventListener('backbutton', function(){
            
            if($.mobile.activePage.is('index.html')){
                    navigator.app.exitApp();
            }
            else {
                    regresaAnt();
            }
            
        }, false);*/

                var db = window.openDatabase("localDB", "1.0", "CookSaveBD", 200000);

                document.addEventListener("offline", function() {
                    networkState = navigator.connection && navigator.connection.type;
                    navigator.notification.alert(
                        'No internet connection state: ' + networkState, // message
                        alertDismissed, // callback
                        'the network is not avaliable', // title
                        'Done' // buttonName
                    );
                }, false);

                $("#frmListaCompra").submit(function(e) {

                    e.preventDefault();
                    db.transaction(function(tx) {
                        tx.executeSql('INSERT INTO tblListaCompra (descripcion_compra,fecha) VALUES (?,?)', [$('#txtDescr_compra').val(), $('#txtFechaCompra').val()], SuccessInsert, errorInsert);
                    }, errorCB, okListaCompra);

                });
                // Transaction error callback
                function errorCB(err) {
                    console.log("Error processing SQL: " + err.code);
                };

                function okListaCompra() {

                    navigator.notification.alert(
                        'List saved', // message
                        okLista, // callback
                        'Register Ok', // title
                        'Done' // buttonName
                    );
                }

                function okLista() {
                    window.location = 'listaCompra.html';
                }

                function SuccessInsert(tx, result) {
                    console.log("Last inserted ID = " + result.insertId);
                }

                function errorInsert(error) {
                    console.log("Error processing SQL: " + error.code);
                }

            });

            function listaLista() {
                window.location = 'listaCompra.html';
            }

            function regresaAnt() {
                window.location = 'listaCompraSelect.html';
            }

            function alertDismissed() {

            }
        </script>



    </div>
</body>